name: Build, Deploy, and Release

on:
  push:
    branches: [release]
  pull_request:
    branches: [release]
  workflow_dispatch:
    inputs:
      release_version:
        description: 'Release version (e.g., 1.3.3)'
        required: true
      development_version:
        description: 'Next development version (e.g., 1.4.0-SNAPSHOT)'
        required: true

jobs:
  build:
    name: Build and Test
    if: github.event_name == 'push' || github.event_name == 'pull_request'
    uses: wikumChamith/openmrs-contrib-gha-workflows/.github/workflows/build-backend-module.yml@release
    with:
      java_versions: '[8]'
      main_java_version: '8'
    secrets:
      NVD_API_KEY: ${{ secrets.NVD_API_KEY }}

  release:
    name: Release
    if: github.event_name == 'workflow_dispatch'
    uses: wikumChamith/openmrs-contrib-gha-workflows/.github/workflows/release-backend-module.yml@release
    with:
      release_version: ${{ inputs.release_version }}
      development_version: ${{ inputs.development_version }}
    secrets:
      MAVEN_REPO_USERNAME: ${{ secrets.MAVEN_REPO_USERNAME }}
      MAVEN_REPO_API_KEY: ${{ secrets.MAVEN_REPO_API_KEY }}
